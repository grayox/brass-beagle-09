<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<!--- ->
<!---->

<link rel="import" href="/bower_components/polymer/polymer-element.html">

<!--- ->
<link rel="import" href="/src/app-main/app-methods.html">

<!-- state -->
<link rel="import" href="/src/app-state/state-route.html">
<link rel="import" href="/src/app-state/state-user-remote.html">
<link rel="import" href="/src/app-state/state-app-settings.html">
<link rel="import" href="/src/app-view/app-view.html">

<link rel="import" href="/bower_components/iron-pages/iron-pages.html">

<!--- ->
<link rel="import" href="/src/app-views/view-dashboard/view-dashboard.html">
<link rel="import" href="/src/app-views/view-outbox/view-outbox.html">
<link rel="import" href="/src/app-views/view-inbox/view-inbox.html">
<link rel="import" href="/src/app-views/view-archive/view-archive.html">
<link rel="import" href="/src/app-views/view-contacts/view-contacts.html">
<link rel="import" href="/src/app-views/view-settings/view-settings.html">
<!--- ->
<link rel="import" href="/src/app-views/view-feedback/view-feedback.html">
<link rel="import" href="/src/app-views/view-help/view-help.html">
<!--- ->
<link rel="import" href="/src/app-views/view-account/view-account.html">
<!---->

<dom-module id="my-app">

  <template>

		<style></style>		
    
    <!---->
    <app-methods id="methods" xshow-toast xdispatch-event></app-methods>
    
		<!-- state -->
		<state-route route="{{route}}"></state-route>		
    <state-app-settings id="settings"
                        app-settings="{{appSettings}}"
                        >
    </state-app-settings>

		<iron-pages selected="{{route}}" xattr-for-selected="name">
		  <template is="dom-repeat" items="[[appSettings]]">
        <app-view items="[[item.items]]"></app-view>
      </template>
    </iron-pages>
    
    <!--- ->
		<iron-pages selected="{{route}}" xattr-for-selected="name">
		  <template is="dom-repeat" items="{{appViews.views}}">
        <app-view name="[[item.name]]"
                  type="[[item.type]]"
                  item-keys="[[item.items]]"
                  >
        </app-view>
      </template>
    </iron-pages>
    <!---->
		

  </template>

  <script>

    class MyApp extends Polymer.Element {

      static get is() { return 'my-app'; }

			static get properties() { return {
        
        // appViews: Object,
			  
        route: {
					type: Number,
					notify: true,
					//observer: '_routeChanged',
				},
			  
        appSettings: {
          type: Array,
          notify: true,
          // computed: _computeItems(appViews),
          // observer: '_appSettingsChanged',
        },
        
      }}
			
      constructor() {
        super();
      }
			
			ready() {
        super.ready();
				//console.log('Component Ready');
				window.addEventListener('detail-save-button', e => this._onDetailSaveButton(e));
        window.addEventListener('valid-zip', e => this._onValidZip(e));
			}
      
			// _routeChanged(route) {
			// 	console.log('route', route);
			// }

      _onValidZip(e) {
        // console.log('data-zip\n', e);
        const d = e.detail;
        //console.log('d', d);
        // this._saveAppSettings(d);
        this.set('appSettings.zip.dataString', d.zipCode);
        const appSettings = this.appSettings;
        // console.log('app-settings\n', appSettings);
        // console.log('user-settings\n', this.userSettings);
        // this._saveAppSettings(appSettings);
        const settings = this.$.settings;
        settings._saveAppSettings(appSettings);
      }

      _onDetailSaveButton(e) {
        const settings = this.$.settings;
        settings.saveAppSettings(e.detail);
      }

      // _appSettingsChanged(newData, oldData) {
      //   console.log('old-data\n', oldData);
      //   console.log('new-data\n', newData);
      // }
			
    }

    customElements.define(MyApp.is, MyApp);

  </script>

</dom-module>
